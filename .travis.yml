env:
  global:
    - EMULATOR_API_LEVEL=16
    - ANDROID_ABI="default;armeabi-v7a"
matrix:
  # This causes the build to complete immediately upon failure or success
  # of all required jobs, allowing all non-required jobs to continue
  fast_finish: true

  # todo: MVU project currently fails on add/edit screen so MVU jobs are allowed to fail
  allow_failures:
    - env: MVU-ANDROID
    - env: MVU-IOS

  include:
    # Run unit tests without emulators.
    - env: UNIT-TEST
      sudo: false
      os: linux
      language: generic
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor
        - pub global activate coverage
      script:
        - ./script/runTests.sh
      after_success:
        - bash <(curl -s https://codecov.io/bash) -f lcov.info

    # Run integration tests on android
    - env: BLOC_FLUTTER-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/bloc_flutter

    # Run integration tests on ios.
    - env: BLOC_FLUTTER-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/bloc_flutter

    # Run integration tests on android
    - env: BUILT_REDUX-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/built_redux

    # Run integration tests on ios.
    - env: BUILT_REDUX-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/built_redux

    # Run integration tests on android
    - env: FIRESTORE_REDUX-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/firestore_redux

    # Run integration tests on ios.
    - env: FIRESTORE_REDUX-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/firestore_redux

    # Run integration tests on android
    - env: INHERITED_WIDGET-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/inherited_widget

    # Run integration tests on ios.
    - env: INHERITED_WIDGET-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/inherited_widget

    # Run integration tests on android
    - env: MVI_FLUTTER-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/mvi_flutter

    # Run integration tests on ios.
    - env: MVI_FLUTTER-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/mvi_flutter

    # Run integration tests on android
    - env: MVU-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/mvu

    # Run integration tests on ios.
    - env: MVU-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/mvu

    # Run integration tests on android
    - env: REDURX-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/redurx

    # Run integration tests on ios.
    - env: REDURX-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/redurx

    # Run integration tests on android
    - env: REDUX-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/redux

    # Run integration tests on ios.
    - env: REDUX-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/redux

    # Run integration tests on android
    - env: SCOPED_MODEL-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/scoped_model

    # Run integration tests on ios.
    - env: SCOPED_MODEL-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/scoped_model

    # Run integration tests on android
    - env: SIMPLE_BLOC_FLUTTER-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/simple_bloc_flutter

    # Run integration tests on ios.
    - env: SIMPLE_BLOC_FLUTTER-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/simple_bloc_flutter

    # Run integration tests on android
    - env: VANILLA-ANDROID
      sudo: false
      os: linux
      language: android
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - build-tools-26.0.3
          - build-tools-27.0.3
      licenses:
          - 'android-sdk-license-.+'
      before_install:
        - sdkmanager --list
        - yes | sdkmanager "platforms;android-26" > /dev/null
        - yes | sdkmanager "platforms;android-27" > /dev/null
        # Install the rest of tools (e.g., avdmanager)
        - sdkmanager tools
        # Create and start emulator.
        - sdkmanager "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI" >/dev/null
        - sdkmanager --list
        - echo no | avdmanager create avd --force -n test -k "system-images;android-$EMULATOR_API_LEVEL;$ANDROID_ABI"
        - $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader &
      addons:
        apt:
          # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
          sources:
            - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
          packages:
            - libstdc++6
            - fonts-droid
      before_script:
        # Wait for emulator to startup.
        - android-wait-for-emulator
        - adb shell input keyevent 82

        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
        - pub global activate coverage
      script:
        - travis_retry ./script/ci.sh ./example/vanilla

    # Run integration tests on ios.
    - env: VANILLA-IOS
      os: osx
      osx_image: xcode8.0
      before_script:
        - open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app
        - brew update
        - brew install libimobiledevice || echo 'ignore exit(1)'
        - brew install ideviceinstaller
        - brew install ios-deploy
        - brew install cocoapods || echo 'ignore exit(1)'
        - brew link --overwrite cocoapods
        - git clone https://github.com/flutter/flutter.git -b beta
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - flutter devices
      script:
        - travis_retry ./script/ci.sh ./example/vanilla

cache:
  directories:
    - $HOME/.pub-cache